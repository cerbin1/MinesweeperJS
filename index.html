<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Minesweeper</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="plantBombs()">
<table>
    <tr>
        <td onclick="playerMove(this)" id="00">00</td>
        <td onclick="playerMove(this)" id="01">01</td>
        <td onclick="playerMove(this)" id="02">02</td>
        <td onclick="playerMove(this)" id="03">03</td>
        <td onclick="playerMove(this)" id="04">04</td>
        <td onclick="playerMove(this)" id="05">05</td>
        <td onclick="playerMove(this)" id="06">06</td>
        <td onclick="playerMove(this)" id="07">07</td>
        <td onclick="playerMove(this)" id="08">08</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="10">10</td>
        <td onclick="playerMove(this)" id="11">11</td>
        <td onclick="playerMove(this)" id="12">12</td>
        <td onclick="playerMove(this)" id="13">13</td>
        <td onclick="playerMove(this)" id="14">14</td>
        <td onclick="playerMove(this)" id="15">15</td>
        <td onclick="playerMove(this)" id="16">16</td>
        <td onclick="playerMove(this)" id="17">17</td>
        <td onclick="playerMove(this)" id="18">18</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="20">20</td>
        <td onclick="playerMove(this)" id="21">21</td>
        <td onclick="playerMove(this)" id="22">22</td>
        <td onclick="playerMove(this)" id="23">23</td>
        <td onclick="playerMove(this)" id="24">24</td>
        <td onclick="playerMove(this)" id="25">25</td>
        <td onclick="playerMove(this)" id="26">26</td>
        <td onclick="playerMove(this)" id="27">27</td>
        <td onclick="playerMove(this)" id="28">28</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="30">30</td>
        <td onclick="playerMove(this)" id="31">31</td>
        <td onclick="playerMove(this)" id="32">32</td>
        <td onclick="playerMove(this)" id="33">33</td>
        <td onclick="playerMove(this)" id="34">34</td>
        <td onclick="playerMove(this)" id="35">35</td>
        <td onclick="playerMove(this)" id="36">36</td>
        <td onclick="playerMove(this)" id="37">37</td>
        <td onclick="playerMove(this)" id="38">38</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="40">40</td>
        <td onclick="playerMove(this)" id="41">41</td>
        <td onclick="playerMove(this)" id="42">42</td>
        <td onclick="playerMove(this)" id="43">43</td>
        <td onclick="playerMove(this)" id="44">44</td>
        <td onclick="playerMove(this)" id="45">45</td>
        <td onclick="playerMove(this)" id="46">46</td>
        <td onclick="playerMove(this)" id="47">47</td>
        <td onclick="playerMove(this)" id="48">48</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="50">50</td>
        <td onclick="playerMove(this)" id="51">51</td>
        <td onclick="playerMove(this)" id="52">52</td>
        <td onclick="playerMove(this)" id="53">53</td>
        <td onclick="playerMove(this)" id="54">54</td>
        <td onclick="playerMove(this)" id="55">55</td>
        <td onclick="playerMove(this)" id="56">56</td>
        <td onclick="playerMove(this)" id="57">57</td>
        <td onclick="playerMove(this)" id="58">58</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="60">60</td>
        <td onclick="playerMove(this)" id="61">61</td>
        <td onclick="playerMove(this)" id="62">62</td>
        <td onclick="playerMove(this)" id="63">63</td>
        <td onclick="playerMove(this)" id="64">64</td>
        <td onclick="playerMove(this)" id="65">65</td>
        <td onclick="playerMove(this)" id="66">66</td>
        <td onclick="playerMove(this)" id="67">67</td>
        <td onclick="playerMove(this)" id="68">68</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="70">70</td>
        <td onclick="playerMove(this)" id="71">71</td>
        <td onclick="playerMove(this)" id="72">72</td>
        <td onclick="playerMove(this)" id="73">73</td>
        <td onclick="playerMove(this)" id="74">74</td>
        <td onclick="playerMove(this)" id="75">75</td>
        <td onclick="playerMove(this)" id="76">76</td>
        <td onclick="playerMove(this)" id="77">77</td>
        <td onclick="playerMove(this)" id="78">78</td>
    </tr>
    <tr>
        <td onclick="playerMove(this)" id="80">80</td>
        <td onclick="playerMove(this)" id="81">81</td>
        <td onclick="playerMove(this)" id="82">82</td>
        <td onclick="playerMove(this)" id="83">83</td>
        <td onclick="playerMove(this)" id="84">84</td>
        <td onclick="playerMove(this)" id="85">85</td>
        <td onclick="playerMove(this)" id="86">86</td>
        <td onclick="playerMove(this)" id="87">87</td>
        <td onclick="playerMove(this)" id="88">88</td>
    </tr>

</table>

<button class="new-game-button" onclick="location.reload()">Start new game</button>

<script>
    var booleanBoard = new Array(9);
    var numberOfBombsAdjacentToField = new Array(9);
    var numberOfBombs = 9;
    var isGameDone = false;

    fillTwoDimensionalBoard(booleanBoard, false);
    fillTwoDimensionalBoard(numberOfBombsAdjacentToField, 0);


    function fillTwoDimensionalBoard(array, value) {
        for (var i = 0; i < 9; i++) {
            array[i] = new Array(9).fill(value);
        }
    }

    function plantBombs() {
        for (var i = 0; i < numberOfBombs; i++) {
            while (true) {
                var first = Math.floor(Math.random() * booleanBoard.length);
                var second = Math.floor(Math.random() * booleanBoard.length);
                if (!booleanBoard[first][second]) {
                    booleanBoard[first][second] = true;
                    console.log(first, second);
                    break;
                }
            }
        }
        fillBoard();
    }

    function fillBoard() {
        for (var i = 0; i < booleanBoard.length; i++) {
            for (var j = 0; j < booleanBoard.length; j++) {
                if (i == 0 && j == 0) {
                    leftTopCorner(0, 0);
                }
                else if (i == 0 && j == 8) {
                    rightTopCorner(0, 8);
                }
                else if (i == 8 && j == 0) {
                    leftBottomCorner(8, 0);
                }
                else if (i == 8 && j == 8) {
                    rightBottomCorner(8, 8);
                }
                else if (i == 0 && j > 0 && j < 8) {
                    topEdge(i, j);
                }
                else if (i > 0 && i < 8 && j == 0) {
                    leftEdge(i, j);
                }
                else if (i > 0 && i < 8 && j == 8) {
                    rightEdge(i, j);
                }
                else if (i == 8 && j > 0 && j < 8) {
                    bottomEdge(i, j);
                }
                else {
                    mid(i, j);
                }
            }
        }
        displayAllBombs();
    }

    function playerMove(object) {
        if(!isGameDone) {
            var x = parseInt(object.id.charAt(0));
            var y = parseInt(object.id.charAt(1));
            if (booleanBoard[x][y]) {
                displayAllBombs();
                alert("Przegrales");
                isGameDone = true;
            }
            else {

                var divToChange = document.getElementById((x.toString() + y.toString()));
                if (numberOfBombsAdjacentToField[x][y] > 0) {
                    divToChange.innerText = numberOfBombsAdjacentToField[x][y];
                    colorNumberOfBombs(numberOfBombsAdjacentToField[x][y], divToChange);
                }
                else {
                    floodFill(x, y);
                }
            }
        }
        else {
            alert("Gra jest skoncozna. Rozpocznij nowa gre");
        }
    }

    function colorNumberOfBombs(numberOfBombs, divToChange) {
        switch (numberOfBombs) {
            case 1:
                divToChange.style.color = "blue";
                break;
            case 2:
                divToChange.style.color = "green";
                break;
            case 3:
                divToChange.style.color = "red";
                break;
            case 4:
                divToChange.style.color = "purple";
                break;
            case 5:
                divToChange.style.color = "orange";
                break;
            case 6:
                divToChange.style.color = "pink";
                break;
        }
        divToChange.style.backgroundColor = "darkGray";
    }
    function floodFill(x, y) {

        if (y < 0) {
            console.log("left border exceeded");
            return;
        }
        if (y > 8) {
            console.log("right border exceeded");
            return;
        }
        if (x < 0) {
            console.log("top border exceeded");
            return;
        }
        if (x > 8) {
            console.log("bottom border exceeded");
            return;
        }
        if (booleanBoard[x][y]) {
            console.log("bomb!");
            return;
        }
        if (document.getElementById(((x).toString() + (y).toString())).style.backgroundColor == "darkgray") {
            console.log("already clicked");
            return;
        }
        if (numberOfBombsAdjacentToField[x][y] > 0) {
            var divToChange = document.getElementById((x.toString() + y.toString()));
            divToChange.innerHTML = numberOfBombsAdjacentToField[x][y].toString();

            colorNumberOfBombs(numberOfBombsAdjacentToField[x][y], divToChange);
            return;
        }
        else {
            document.getElementById(((x).toString() + (y).toString())).style.backgroundColor = "darkGray";
            document.getElementById(((x).toString() + (y).toString())).innerHTML = "";
        }
        floodFill(x, y - 1);
        floodFill(x, y + 1);
        floodFill(x + 1, y);
        floodFill(x - 1, y);
        floodFill(x - 1, y - 1);
        floodFill(x - 1, y + 1);
        floodFill(x + 1, y - 1);
        floodFill(x + 1, y + 1);
    }


    function leftTopCorner(x, y) {
        if (booleanBoard[0][1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[1][0]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[1][1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function rightTopCorner(x, y) {
        if (booleanBoard[0][7]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[1][7]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[1][8]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function leftBottomCorner(x, y) {
        if (booleanBoard[7][0]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[7][1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[8][0]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function rightBottomCorner(x, y) {
        if (booleanBoard[7][7]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[7][8]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[8][7]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function topEdge(x, y) {
        if (booleanBoard[x][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function leftEdge(x, y) {
        if (booleanBoard[x - 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function rightEdge(x, y) {
        if (booleanBoard[x - 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function bottomEdge(x, y) {
        if (booleanBoard[x - 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function mid(x, y) {
        if (booleanBoard[x - 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x - 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y - 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
        if (booleanBoard[x + 1][y + 1]) {
            numberOfBombsAdjacentToField[parseInt(x)][parseInt(y)]++;
        }
    }

    function displayAllBombs() {
        for (var i = 0; i < booleanBoard.length; i++) {
            for (var j = 0; j < booleanBoard.length; j++) {
                if (booleanBoard[i][j]) {
                    document.getElementById((i.toString() + j.toString())).style.backgroundColor = "red";
                }
            }
        }
    }

</script>
</body>
</html>